'use strict'

const express = require ('express')
const fs = require ('fs')
const multer = require ('multer')

const upload = multer ()

const donutController  = require ('../controllers/donutController')
const methodController = require ('../controllers/methodController')

const router = express.Router ()

router.use (express.static ('./client/build/'))

router.route ('/api/upload')
  .post(upload.single('file'), (req, res)=>{
    let str = req.file.buffer.toString ('utf8')

    console.log ('🍩 Downloading XML file...')
    console.log (str.substring (0, 20))

    fs.writeFileSync ('controllers/dunkin.xml', str)

    

    
    res.end (JSON.stringify ({status: "ok", donut: "🍩" }))
  })

router.get (["/", "/login", "/logout"], (req, res) => { res.sendFile ("index.html", { root: "./client/build/" })})

router.get ('/api/chocoDonut', donutController.getChocoDonut)
router.get ('/api/accountTotals', donutController.getAccountTotals)
router.get ('/api/employees', donutController.getEmployees)
router.get ('/api/methodReport', methodController.getMethodReport)
            
module.exports = router
